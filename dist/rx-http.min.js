!function(e,t){"function"==typeof define&&define.amd?define(["rx","lodash","js-cookie"],t):"object"==typeof exports?module.exports=t(require("rx"),require("lodash"),require("js-cookie")):e.RxHttp=t(e.Rx,e._,e.Cookies)}(this,function(e,t,r){"use strict";function n(e){return"[object File]"===toString.call(e)}function i(e){return"[object FormData]"===toString.call(e)}function o(e){return"[object Blob]"===toString.call(e)}function s(e){function r(e){var r=void 0;return function(){return t.isUndefined(e)&&(r=t.isFunction(e)?e():e),r}}var n=this;this.status=r(e.status),this.statusText=r(e.statusText),this.headers=r(e.getAllResponseHeaders),this.header=function(e){return n.headers()[e]},this.body=r(e.response)}function u(e){this.method=function(r){return t.isUndefined(r)?e.method:(e.method=r,this)},this.header=function(r,n){return t.isUndefined(n)?e.headers[r]:(e.headers[r]=n.toString(),this)},this.headers=function(r){return t.isUndefined(r)?Object.assign({},e.headers):(e.headers=r,this)},this.query=function(r,n){return t.isUndefined(r)?t.isUndefined(n)?t.isObject(r)?(e.query=r,this):e.query[r]:(e.query[r]=n,this):Object.assign({},e.query)},this.body=function(r){return t.isUndefined(r)?e.body:(e.body=r,this)},this.timeout=function(r){return t.isUndefined(r)?e.timeout:(e.timeout=r,this)},this.retries=function(r){return t.isUndefined(r)?e.retries:(e.retries=r,this)},this.execute=function(){return e.provider(this)}}function a(e,r,n){function i(e,t){t(e)}function o(e,t,r){r(e)}function s(e,r){return function(e){function i(e,s){if(t.isEmpty(e))n(s);else{var u=t.head(e),a=t.tail(e),d=u.requestError||o,c=t.partial(i,a);d(s,r,c)}}i()}}this.run=function(n){function o(e,u){if(t.isEmpty(e))r(n);else{var a=t.head(e),d=t.tail(e),c=a.request||i,f=t.partial(o,d);c(n,f,s(d,f))}}o(e,n)}}function d(e,r,n){function i(e,t){t(request)}function o(e,t,r){r(e)}function s(e,r){return function(e){function i(e,s){if(t.isEmpty(e))n(s);else{var u=t.head(e),a=t.tail(e),d=u.responseError||o,c=t.partial(i,a);d(s,r,c)}}i()}}this.run=function(n){function o(e,u){if(t.isEmpty(e))r(n);else{var a=t.head(e),d=t.tail(e),c=a.response||i,f=t.partial(o,d);c(n,f,s(d,f))}}o(e,request)}}function c(r){function n(e,n,o){function u(e,t){n.onNext({type:e,progress:t})}function a(e){o>0?i(n,o-1):(n.onError(e),n.onCompleted())}e.upload&&(e.upload.addEventListener("progress",t.partial(u,l.UPLOAD_PROGRESS)),e.upload.addEventListener("error",a),e.upload.addEventListener("abort",a)),e.addEventListener("progress",t.partial(u,l.DOWNLOAD_PROGRESS)),e.addEventListener("error",a),e.addEventListener("abort",a),e.addEventListener("load",function(t){var i=new s(e),o=r.interceptors(),u=function(e){n.onNext({type:l.RESPONSE_RECEIVED,response:e})};new d(o,u,a).run(i)})}function i(e){var i=arguments.length<=1||void 0===arguments[1]?r.retries():arguments[1],o=new XmlHttpRequest;n(o,e,i),o.open(r.method(),r.url()),t.isInteger(r.timeout())&&(o.timeout=r.timeout());var s=r.headers();Object.keys(s).forEach(function(e){o.setRequestHeader(e,s[e])});var u=r.interceptors(),d=function(e){return o.send(e.body())},c=function(t){e.onError(t),e.onCompleted()};new a(u,d,c).run(r)}var o=e.Observable.create(i).share(),u=o.filter(function(e){return e.type===l.UPLOAD_PROGRESS}).map(function(e){return e.progress}),c=o.filter(function(e){return e.type===l.DOWNLOAD_PROGRESS}).map(function(e){return e.progress}),f=o.filter(function(e){return e.type===l.RESPONSE_RECEIVED}).map(function(e){return e.response});return{uploadProgress:u,downloadProgress:c,response:f}}function f(){function e(e){return function(r){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return i(r,t.assign({method:e},n))}}var r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.assign({},f.defaults,r);this.timeout=function(e){return t.isInteger(e)?(n.timeout=e,this):n.timeout},this.baseUrl=function(e){return t.isString(e)?(n.baseUrl=e,this):n.url},this.retries=function(e){return t.isInteger(e)?(n.retries=e,this):n.retries},this.interceptors=function(e){return t.isArray(e)?(n.interceptors=e,this):n.interceptors},this.addInterceptor=function(e){return n.interceptors.push(e),this},this.removeInterceptor=function(e){return n.interceptors=t.remove(n.interceptors,function(t){return t===e}),this};var i=this.request=function(e){arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new u(n)};this.head=e("HEAD"),this.get=e("GET"),this.options=e("OPTIONS"),this["delete"]=e("DELETE"),this.trace=e("TRACE"),this.post=e("POST"),this.put=e("PUT"),this.patch=e("PATCH")}var h=["GET","POST"],p={BodyTransformer:{request:function(e){function t(t,r,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,r,s){var u=e.body();if(t.isObject(u)&&!n(u)&&!i(u)&&!o(u)){var a=JSON.stringify(u);e.body(a)}r(e)})},XSRF:{request:function(e){function t(t,r,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,n,i){var o=r.get(e.xsrfCookieName()),s=e.xsrfHeaderName();t.isString(o)&&e.header(s,o),n(e)})},ErrorHandling:{response:function(e,t,r){e.status()/100===2?t(e):r(e)}},MethodOverride:{request:function(e){function t(t,r,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,r){var n=e.method();h.some(function(e){return e===n})||e.method("POST").header("X-HTTP-Method-Override",n),t(e)})}},l={UPLOAD_PROGRESS:"UPLOAD_PROGRESS",DOWNLOAD_PROGRESS:"DOWNLOAD_PROGRESS",RESPONSE_RECEIVED:"RESPONSE_RECEIVED"},E=function(){var e=!t.isUndefined(process)&&!t.isUndefined(process.release)&&!t.isUndefined(process.release.name)&&-1!==process.release.name.search(/node|io.js/);if(e)throw new Error("Node.js is not yet supported!");return c}();return f.defaults={baseUrl:"",retries:0,timeout:3e4,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",interceptors:[p.MethodOverride,p.BodyTransformer,p.XSRF,p.ErrorHandling],provider:E},f});
//# sourceMappingURL=rx-http.min.js.map
